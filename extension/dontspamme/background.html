<script>
function onAppResponse(tab, response){
    chrome.tabs.sendRequest(tab.id, )
}

function requestNewPseudonym(tab, domain){
    var request = new XMLHttpRequest();

    if (request == null){
        //Unable to create request

    } else {
        request.onreadystatechange = function(){
            if(request.readyState == 4){
                onAppResponse(tab, request)
            }
        }

        request.open(
            "GET",
            url = "https://" + config.domain + "/extension/";,
            true
        );
        request.send(null);
    }    
}

function onButtonClicked(tab){
    var domain = tab.url.split(/\/+/g)[1];
    requestNewPseudonym(tab, domain);
}

chrome.browserAction.onClicked.addListener(onButtonClicked)
</script>